
# Invoice to Xero CSV Extractor (MVP)
** Generated By Gemini - Use with review and caution! ***

# Gemini Prompt
I want to create an application to convert an invoice pdf file into a csv file containing all the invoice lines details.

The output should be compatible with Xero application.

I'd like to use a Local LLM using LM Studio or similar on a Windows PC running windows 11 and 32gb RAM and optionally use an nvidia GPU 4070 / 5070 type.

The application should be able to have multiple files dragged and dropped into the interface or the ability to have an open dialog select one or more files.

The coding language can use any of the following: html/javascript, nodejs, c# or python.

Consider all the requirements above and create an MVP application with code and all the dependancies required to get this working.

# What it is

This application is a Minimum Viable Product (MVP) designed to extract line-item details from PDF invoices and convert them into a CSV file compatible with Xero's "Sales Invoice" import template.

It uses a locally-run Large Language Model (LLM) via **LM Studio** to ensure data privacy and avoid API costs. The application provides a simple graphical user interface (GUI) to select one or more PDF files and processes them in a batch.

## How It Works

The system is split into two parts: a local AI server and the Python client app.

1.  **LM Studio (The Server):** You run LM Studio on your computer, loading an AI model (like Llama 3 8B). This turns your PC into an AI server, available at `http://localhost:1234`. Your GPU (e.g., NVIDIA 4070/5070) will be used for fast processing.
    
2.  **Python App (The Client):** This is the `main.py` script. It provides the user interface. When you process files, it:
    
    -   Reads the text from each PDF.
        
    -   Sends this text to your local LM Studio server.
        
    -   Receives structured JSON data (invoice details) back from the AI.
        
    -   Converts this JSON into the Xero-compatible CSV format.
        
    -   Saves the final CSV file to your computer.
        

## Setup Instructions

### Step 1: Set Up Your Local AI Server (LM Studio)

You only need to do this once.

1.  **Download LM Studio:** Go to [lmstudio.ai](https://lmstudio.ai/ "null") and download the application for Windows.
    
2.  **Download an AI Model:**
    
    -   Open LM Studio.
        
    -   On the home screen search (top center), type `Llama 3 8B Instruct` and press Enter.
        
    -   Find a GGUF model from the list, such as **"Meta-Llama-3-8B-Instruct.Q5_K_M.gguf"** (or a similar quality variant). Click **Download**.
        
3.  **Start the Server:**
    
    -   Click the **"Server"** tab (icon looks like `<>`) on the left side.
        
    -   At the top, select the Llama 3 model you just downloaded.
        
    -   On the right-hand panel, find **"GPU Offload"**. Check the box and slide it to **"Max"** to use your NVIDIA GPU.
        
    -   Click **"Start Server"**.
        

Leave LM Studio running in the background. The server logs should confirm it's "running at `http://localhost:1234`".

### Step 2: Set Up the Python Application

1.  **Install Python:** If you don't have it, download and install **Python 3.10 or newer** from [python.org](https://www.python.org/downloads/ "null").
    
    -   **Important:** During installation, make sure to check the box that says **"Add Python to PATH"**.
        
2.  **Create Your Project Folder:**
    
    -   Create a new folder for your project (e.g., `C:\Projects\InvoiceExtractor`).
        
3.  **Add Project Files:**
    
    -   Copy the `main.py` script into this new folder.
        
    -   In the same folder, create a new file named `requirements.txt`.
        
4.  **Edit `requirements.txt`:**
    
    -   Open `requirements.txt` with Notepad and add the following lines, which list the libraries our app needs:
        
        ```
        customtkinter
        PyMuPDF
        requests
        
        ```
        
5.  **Install Dependencies:**
    
    -   Open a Windows Command Prompt in your project folder. (A quick way: navigate to your folder in File Explorer, click the address bar, type `cmd`, and press Enter).
        
    -   In the command prompt, run the following command to install the required libraries:
        
        ```
        pip install -r requirements.txt
        
        ```
        

## How to Run the Application

1.  **Ensure LM Studio is running:** Double-check that your LM Studio server (from Step 1) is running.
    
2.  **Run the Python script:** In your command prompt (which should still be in your project folder), run the application:
    
    ```
    python main.py
    
    ```
    
3.  **Use the App:**
    
    -   The application window will appear.
        
    -   Click **"1. Select Invoice PDFs"** to open a dialog and select one or more PDF files.
        
    -   Click **"2. Process and Save CSV"**. The app will go through each file, extract the text, and query your local AI. The status bar at the bottom will show the progress.
        
    -   Once complete, a "Save As" dialog will appear. Choose a name and location for your final Xero-compatible CSV file.
        

## ! IMPORTANT: Configuration

This is an MVP, and one critical part **must be configured by you** to work with your Xero account.

Open `main.py` in an editor (like Notepad or VS Code) and find the `flatten_json_to_xero_rows` function (around line 225).

You **MUST** change these two lines to match your Xero Chart of Accounts:

```
# ... inside flatten_json_to_xero_rows ...

# --- Add Xero-specific defaults ---
# These are required by Xero. You should change these
# to match your own Chart of Accounts.
row_dict["*AccountCode"] = "200"  # "200" is typically "Sales"
row_dict["*TaxType"] = "GST on Income" # Or "Tax Free", "No GST", etc.

```

If you don't update these values to valid codes from your Xero account, the CSV import into Xero will fail.
